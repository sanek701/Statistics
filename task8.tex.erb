
<% require 'yaml' %>

<% global = YAML.load_file("data/global.yaml") %>
<% data = YAML.load_file("data/#{global['variant']}.yaml") %>

<% require './statistic.rb' %>
<% require './latex_helper.rb' %>
<% include LatexHelper %>

<%
sample = {}
for i in 1 .. 7
  sample[i] = Statistic::Sample::new(data[i]['data'])
  sample[i].hist_step = data[i]['histstep'] if data[i]['histstep']
  sample[i].hist_start  = data[i]['histstart'] if data[i]['histstart']
end
%>

\subsection*{\hspace*{\parindent}Задание 8}
С уровнем значимости <%= 0.1 %> проверить гипотезу о равенстве
нулю коэффициентов ранговой корреляции Спирмена для приведенных 
в задании 8 оценок (рейтинга) студентов для каждых двух из трех 
указанных для своего варианта предметов.

\par
{\em Решение.} 
Рейтинг студента по данной дисциплине является значением соответствующего
признака. Чтобы оценить тесноту связи между признаками, требуется упорядочить 
(ранжировать) совокупность объектов по возрастанию или убыванию значений признаков. 
Каждому объекту $i$ после упорядочения по данному признаку приписывается его 
порядковый номер (ранг) $r_i$ для первого признака и $s_i$ для второго. Теснота
связи между этими признаками характеризуется коэффициентом ранговой корреляции 
Спирмена:
$$
	\rho = 1 - \dfrac{6\sum\limits_{i=1}^n\,(r_i-s_i)^2}{n^3-n},
$$
где $n$~--- количество объектов (в нашем задании $n = <%= sample[5].size %>$).

При полной прямой связи, то есть когда ранги каждого объекта по первому и второму 
признакам совпадают ($\forall i \,r_i = s_i$), $\rho = 1$; при полной 
обратной связи, когда объекты ранжированы по двум признакам в противоположном 
порядке, $\rho = -1$; в остальных случаях $-1 \leq \rho \leq 1$.

При проверке значимости $\rho$ исходят из того, что в случае справедливости 
нулевой гипотезы об отсутствии корреляционной связи между переменными 
при $n > 10$ критерий:
$$
	t = \rho\dfrac{\sqrt{n - 2}}{\sqrt{1 - \rho^2}}
$$
имеет $t$-распределение Стьюдента с $k = n - 2$ степенями свободы. 
Поэтому $\rho$ значимо отличается от $0$ на уровне $\alpha$ (в задании 
$\alpha = <%= 0.1 %>$), если фактически наблюдаемое значение $t$ по
абсолютной величине будет больше критического.

Табл.~\ref{tab:12} содержит исходные данные рейтинга, а табл.~\ref{tab:13}~--- 
ранги студентов по каждому предмету, включая связанные ранги.
<%
n = sample[5].size
t = 1.70113
# bad design =\
def rho(r1, r2)
  n = r1.size
  return 1.0 - 6.0*(0...n).map { |i| (r1[i] - r2[i])**2}.reduce(:+)/(n**3 - n)
end

def t_sp(rh, n)
  rh*Math::sqrt((n-2)/(1 - rh*rh))
end

def rank_put(r)
  return r.round if r.round == r
  return r
end
 
rank = []
for i in 5 .. 7
  rank[i] = sample[i].ranks
  
end

rho56 = rho(rank[5], rank[6])
t56 = t_sp(rho56, n)
rho56, t56 = roundn(rho56, 6), roundn(t56, 6)

rho57 = rho(rank[5], rank[7])
t57 = t_sp(rho57, n)
rho57, t57 = roundn(rho57, 6), roundn(t57, 6)

rho67 = rho(rank[6], rank[7])
t67 = t_sp(rho67, n)
rho67, t67 = roundn(rho67, 6), roundn(t67, 6)
%>  
Во всех трех сравнениях критическое значение $t_{\alpha, n-2}$ при 
$\alpha = <%= 0.1 %>$ и $n = <%= n %>$
будет одним и тем же и равным $<%= t %>$. В табл.~\ref{tab:14} приведены 
значения коэффициентов ранговой корреляции для пар дисциплин 
<<<%= "#{data[5]['title']}--#{data[6]['title']}" %>>>,
<<<%= "#{data[5]['title']}--#{data[7]['title']}" %>>> и 
<<<%= "#{data[6]['title']}--#{data[7]['title']}" %>>>,
а также соответствующие значения $t_{\text{набл}}$.

\par
{\em Вывод.}
Сравнение наблюдаемых и критических значений позволяет сделать выводы о
коррелированности признаков.
$\\$
Ранговая корреляция по признакам <<<%= "#{data[5]['title']}--#{data[6]['title']}" %>>>:

<%if t56.abs < t%>
	$|t_{\text{набл}}| = <%= t56.abs %> < <%= t %> = t_{\text{крит}}$,
	Следовательно, нет оснований отвергнуть гипотезу $H_0$ о ранговой некоррелированности 
	этих признаков в пользу гипотезы $H_1$ c уровнем значимости 0{,}1: можно
	считать, что ранговая корреляция между ними отсутствует.
<% else %>
	$|t_{\text{набл}}| = <%= t56.abs %> > <%= t %> = t_{\text{крит}}$,
	Следовательно, отвергаем гипотезу $H_0$ о ранговой некоррелированности 
	этих признаков в пользу гипотезы $H_1$ c уровнем значимости 0{,}1.
	<% if (rho56.abs-1).abs <= 0.1 && rho56 > 0%>
	Кооэффициент корреляции Спирмена близок к $1$, связь <<лучший-лучший>>.
	<% elsif (rho56.abs-1).abs <= 0.1 && rho56 < 0%>
	Кооэффициент корреляции Спирмена близок к $-1$, связь <<лучший-худший>>.
	<% else %>
	Связь между оценками весьма слабая.	
	<% end %>
<% end %>
$\\$
Ранговая корреляция по признакам <<<%= "#{data[5]['title']}--#{data[7]['title']}" %>>>:

<%if t57.abs < t%>
	$|t_{\text{набл}}| = <%= t57.abs %> < <%= t %> = t_{\text{крит}}$,
	Следовательно, нет оснований отвергнуть гипотезу $H_0$ о ранговой некоррелированности 
	этих признаков в пользу гипотезы $H_1$ c уровнем значимости 0{,}1: можно
	считать, что ранговая корреляция между ними отсутствует.
<% else %>
	$|t_{\text{набл}}| = <%= t57.abs %> > <%= t %> = t_{\text{крит}}$,
	Следовательно, отвергаем гипотезу $H_0$ о ранговой некоррелированности 
	этих признаков в пользу гипотезы $H_1$ c уровнем значимости 0{,}1.
	<% if (rho57.abs-1).abs <= 0.1 && rho57 > 0%>
	Кооэффициент корреляции Спирмена близок к $1$, связь <<лучший-лучший>>.
	<% elsif (rho57.abs-1).abs <= 0.1 && rho57 < 0%>
	Кооэффициент корреляции Спирмена близок к $-1$, связь <<лучший-худший>>.
	<% else %>
	Связь между оценками весьма слабая.	
	<% end %>
<% end %>
$\\$
Ранговая корреляция по признакам  <<<%= "#{data[6]['title']}--#{data[7]['title']}" %>>>:
<%if t67.abs < t%>
	$|t_{\text{набл}}| = <%= t67.abs %> < <%= t %> = t_{\text{крит}}$,
	Следовательно, нет оснований отвергнуть гипотезу $H_0$ о ранговой 
	некоррелированности этих признаков: можно считать, что ранговая корреляция 
	между ними отсутствует.
<% else %>
	$|t_{\text{набл}}| = <%= t67.abs %> > <%= t %> = t_{\text{крит}}$,
	Следовательно, отвергаем гипотезу $H_0$ о ранговой некоррелированности 
	этих признаков в пользу гипотезы $H_1$ c уровнем значимости 0{,}1.
	<% if (rho67.abs-1).abs <= 0.1 && rho67 > 0%>
	Кооэффициент корреляции Спирмена близок к $1$, связь <<лучший-лучший>>.
	<% elsif (rho67.abs-1).abs <= 0.1 && rho67 < 0%>
	Кооэффициент корреляции Спирмена близок к $-1$, связь <<лучший-худший>>.
	<% else %>
	Связь между оценками весьма слабая.	
	<% end %>
<% end %>

\begin{table}[h]
  \begin{minipage}[h]{0.49\linewidth}
    \caption{Исходные данные рейтинга.}\label{tab:12}
  \end{minipage}
  \begin{minipage}[h]{0.49\linewidth}
    \caption{Ранги дисциплин}\label{tab:13}
  \end{minipage}
  \begin{minipage}[h]{0.49\linewidth}
    \begin{tabular}{|c|c|c|}
      \hline
      <%= data[5]['title'] %> & <%= data[6]['title'] %> & <%= data[7]['title'] %> 
      \\ \hline
      <% (0...n).each do |i| %>
        <%= sample[5][i] %> & <%= sample[6][i] %> & <%= sample[7][i] %> 
        \\ \hline
      <% end %>
    \end{tabular}
  \end{minipage}
  \begin{minipage}[h]{0.49\linewidth}
    \begin{tabular}{|c|c|c|}
      \hline
      <%= data[5]['title'] %> & <%= data[6]['title'] %> & <%= data[7]['title'] %> 
      \\ \hline
      <% (0...n).each do |i| %>
        <%= rank_put(rank[5][i]) %> & <%= rank_put(rank[6][i]) %> & <%= rank_put(rank[7][i]) %> 
        \\ \hline
      <% end %>
    \end{tabular}
  \end{minipage}
\end{table}

\begin{table}[h]
\caption{Выборочные коэффициенты ранговой корреляции Спирмена 
и наблюдаемые значения критерия, для проверки их значимости.}\label{tab:14}
\begin{tabular}{|c|c|c|}
\hline
Пары дисциплин & $\rho$ & $t_{\text{набл}}$ 
\\ \hline
<%= "#{data[5]['title']}--#{data[6]['title']}" %> & $<%= rho56 %>$ & $<%= t56 %>$ 
\\ \hline
<%= "#{data[5]['title']}--#{data[7]['title']}" %> & $<%= rho57 %>$ & $<%= t57 %>$ 
\\ \hline
<%= "#{data[6]['title']}--#{data[7]['title']}" %> & $<%= rho67 %>$ & $<%= t67 %>$ 
\\ \hline
\end{tabular}
\end{table}

\par 
%% да убейся же ты наконец
\vspace*{5em}
\endinput
